<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>College Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
  --royal-blue:#0b3d91;
  --royal-blue-dark:#072a65;
  --gold:#ffd166;
  --text:#0b1b2b;
  --wrong:#d32f2f;
  --correct:#2e7d32;
  --panel:#ffffff;
  --bg:#f3f7ff;
  --pass-orange:#ff7f11;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* Header with two logos */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 16px;
  background:#fff;
  border-bottom:4px solid var(--royal-blue);
}
.logo{
  height:60px;
  width:auto;
  object-fit:contain;
}
.brand{
  margin:0;
  font-size:28px;
  color:var(--royal-blue);
  letter-spacing:0.5px;
}

/* Layout */
.layout{
  display:flex;
  gap:16px;
  padding:16px;
}
.quiz-panel{
  flex:1 1 70%;
  background:var(--panel);
  border:2px solid var(--royal-blue);
  border-radius:12px;
  padding:16px;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}
.scoreboard{
  flex:0 0 28%;
  background:#fffdf6;
  border:2px solid var(--royal-blue);
  border-radius:12px;
  padding:16px;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}

/* Controls / Timer */
.controls{
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:8px;
}
.timer-label input{
  width:80px;
  padding:6px 8px;
  font-size:16px;
}
.timer{
  font-weight:700;
  font-size:20px;
}
.timer.red{ color:#d32f2f; animation: pulse 1s infinite; }
.timer.orange{ color:var(--pass-orange); }
@keyframes pulse{ 0%{opacity:1} 50%{opacity:.6} 100%{opacity:1} }

/* Current team */
.current-team{ font-weight:700; margin:6px 0 10px; }
.current-team .name{
  background:var(--gold);
  padding:3px 8px;
  border-radius:6px;
}

/* Question band */
.question-band{
  background:var(--royal-blue);
  border:2px solid var(--royal-blue-dark);
  border-radius:12px;
  padding:16px;
  margin-bottom:12px;
}
.question-text{
  color:#fff;
  font-weight:800;
  font-size:28px;
  line-height:1.3;
}

/* Options grid */
.options{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:8px;
}
.option{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  min-height:64px;
  border:2px solid var(--royal-blue);
  border-radius:10px;
  background:#fff;
  font-size:18px;
  font-weight:600;
  cursor:pointer;
  padding:10px;
  transition:transform .05s ease, background .2s ease, border-color .2s ease;
}
.option:hover{ background:#e8f1ff }
.option:disabled{ opacity:.6; cursor:not-allowed }

.option.correct{
  background:var(--correct);
  color:#fff;
  border-color:#1b5e20;
}
.option.wrong{
  background:var(--wrong);
  color:#fff;
  border-color:#b71c1c;
}

/* Image options */
.option img{
  max-height:110px;
  max-width:100%;
  object-fit:contain;
  border-radius:6px;
  display:block;
}

/* Buttons */
.action-row{
  display:flex;
  gap:10px;
  margin-top:12px;
  flex-wrap:wrap;
}
.btn{
  border:2px solid var(--royal-blue);
  background:#e8f1ff;
  color:#012150;
  padding:10px 14px;
  font-weight:700;
  border-radius:10px;
  cursor:pointer;
  min-width:180px;
}
.btn:disabled{ opacity:.5; cursor:not-allowed; }
.btn.primary{ background:var(--gold); border-color:#caa245; }

/* Scoreboard list */
.team{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px 8px;
  border:1px solid #e6d49a;
  border-radius:8px;
  margin-bottom:8px;
  background:#fff8e1;
}
.team.active{ outline:3px solid var(--gold); }
.team input[type="text"]{
  flex:1;
  padding:6px 8px;
  font-size:14px;
  border:1px solid #c9b46b;
  border-radius:6px;
  background:#fffceb;
}
.score{
  width:70px;
  text-align:center;
  font-weight:800;
  background:#fffbea;
  border:1px solid #e1cf8a;
  border-radius:6px;
  padding:4px 0;
}
.team .smallbtn{
  padding:4px 8px;
  border:1px solid var(--royal-blue);
  border-radius:6px;
  background:#eef5ff;
  cursor:pointer;
}

/* Full-screen flashing overlay */
.timeout-overlay {
  position: fixed;
  inset: 0;
  background: rgba(211, 47, 47, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 72px;
  font-weight: 900;
  z-index: 9999;
  visibility: hidden;
  pointer-events: none;
}

@keyframes flash {
  0%   { opacity: 0.25; transform: scale(1); }
  50%  { opacity: 0.8; transform: scale(1.05); }
  100% { opacity: 0.25; transform: scale(1); }
}

/* Responsive */
@media (max-width: 1000px){
  .layout{flex-direction:column}
  .scoreboard{flex-basis:auto}
  .options{grid-template-columns:1fr}
}
</style>
</head>
<body>
<!-- Full-screen red flash overlay -->
<div id="timeout-overlay" class="timeout-overlay"></div>

<!-- Header with logos -->
<header class="header">
  <img id="logoLeft" class="logo" alt="Logo 1" />
  <h1 class="brand">College Quiz</h1>
  <img id="logoRight" class="logo" alt="Logo 2" />
</header>

<main class="layout">
  <section class="quiz-panel">
    <div class="controls">
      <label class="timer-label">
        Timer (sec):
        <input type="number" id="timerInput" min="5" value="30" />
      </label>
      <div class="timer">Time Left: <span id="time">30</span>s</div>
    </div>

    <div id="currentTeam" class="current-team"></div>

    <div class="question-band">
      <div id="question" class="question-text">Loading questionâ€¦</div>
    </div>

    <div id="options" class="options"></div>

    <div class="action-row">
      <button id="showAnswerBtn" class="btn" disabled>Show Correct Answer</button>
      <button id="nextBtn" class="btn primary" disabled>Next Question</button>
    </div>
  </section>

  <aside class="scoreboard">
    <h2>Leaderboard</h2>
    <div id="teams"></div>
  </aside>
</main>

<script>
/********** CONFIG **********/
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRiqqInQm40Eo-MOFDuPOC40etCZdH3Fxnb5ZrZwJk2ziHeIVGOYyQ0xqWKNsL-vw1FxEfYzr7u18fZ/pub?output=csv";
const LOGO_LEFT  = "https://drive.google.com/uc?export=view&id=1QCjEZ7XRiElI9pBeyCxtfnFLh_xuB4iS";
const LOGO_RIGHT = "https://drive.google.com/uc?export=view&id=1xKpU5akmap9vLgxtVyL0HMX1bsKUQdFl";
const PASS_POINTS = [4,3,2,1];
const PASS_SECONDS = 5;

/* DOM refs */
document.getElementById("logoLeft").src = LOGO_LEFT;
document.getElementById("logoRight").src = LOGO_RIGHT;

const timerInput = document.getElementById("timerInput");
const timeEl = document.getElementById("time");
const timerBox = document.querySelector(".timer");
const overlay = document.getElementById("timeout-overlay");

const currentTeamEl = document.getElementById("currentTeam");
const qText = document.getElementById("question");
const optionsWrap = document.getElementById("options");
const showAnswerBtn = document.getElementById("showAnswerBtn");
const nextBtn = document.getElementById("nextBtn");
const teamsWrap = document.getElementById("teams");

/* State */
let questions = [], qIndex = 0;
let teams = [{name:"Team A",score:0},{name:"Team B",score:0},{name:"Team C",score:0},{name:"Team D",score:0}];
let startTeamIndex = 0, currentTeam = 0, passCount = 0;
let timerId = null, timeLeft = 30, isPassTurn = false;
let clickedSet = new Set(), correctIndex = -1, questionCompleted = false;

/* Utils */
function csvToRows(csvText){
  const rows=[], row=[], cell="", inQuotes=false;
  let r=[], c="", q=false;
  for(let i=0;i<csvText.length;i++){
    const ch=csvText[i];
    if(ch==='"'){ if(q && csvText[i+1]==='"'){ c+='"'; i++; } else q=!q; }
    else if(ch===',' && !q){ r.push(c); c=""; }
    else if(ch==='\n' && !q){ r.push(c); rows.push(r); r=[]; c=""; }
    else c+=ch;
  }
  if(c.length || r.length){ r.push(c); rows.push(r); }
  return rows;
}
function isImageUrl(s){
  if(!s) return false;
  const lower=s.trim().toLowerCase();
  return lower.startsWith("img:") || /^https?:\/\/.+\.(png|jpe?g|webp|gif|svg)(\?.*)?$/i.test(lower);
}

/* Leaderboard */
function renderTeams(){
  teamsWrap.innerHTML="";
  teams.forEach((t,idx)=>{
    const row=document.createElement("div");
    row.className="team"+(idx===currentTeam?" active":"");
    row.innerHTML=`<input type="text" value="${t.name}" />
      <span class="score" contenteditable="true">${t.score}</span>
      <button class="smallbtn" data-i="${idx}" data-delta="1">+1</button>
      <button class="smallbtn" data-i="${idx}" data-delta="-1">-1</button>
      <button class="smallbtn" data-i="${idx}" data-delta="5">+5</button>
      <button class="smallbtn" data-i="${idx}" data-delta="-5">-5</button>`;
    row.querySelector("input").addEventListener("change",e=>{
      teams[idx].name=e.target.value.trim()||`Team ${idx+1}`;
      updateCurrentTeamDisplay();
    });
    row.querySelector(".score").addEventListener("input",()=>{ teams[idx].score=parseInt(row.querySelector(".score").innerText.replace(/[^\d-]/g,""))||0 });
    row.querySelectorAll(".smallbtn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const i=+btn.dataset.i, delta=+btn.dataset.delta;
        teams[i].score+=delta; renderTeams();
      });
    });
    teamsWrap.appendChild(row);
  });
}
function updateCurrentTeamDisplay(){
  currentTeamEl.innerHTML=`Current Team: <span class="name">${teams[currentTeam].name}</span> (Pass ${passCount})`;
  document.querySelectorAll(".team").forEach((el,i)=> el.classList.toggle("active",i===currentTeam));
}

/* Timer */
function startTimerMain(){ isPassTurn=false; startTimer(parseInt(timerInput.value,10)||30); }
function startTimerPass(){ isPassTurn=true; startTimer(PASS_SECONDS); }
function startTimer(seconds){
  clearInterval(timerId);
  overlay.style.visibility="hidden";
  timerBox.classList.remove("red","orange");
  timeLeft=seconds;
  timeEl.textContent=timeLeft;

  timerId=setInterval(()=>{
    timeLeft--;
    timeEl.textContent=timeLeft;

    if(!isPassTurn){ timerBox.classList.toggle("red",timeLeft<=10 && timeLeft>0); }
    else{ timerBox.classList.toggle("orange",timeLeft<=3 && timeLeft>0); }

    if(timeLeft<=0){
      clearInterval(timerId);
      flashOverlay();
      handleAutoPassOrEnd();
    }
  },1000);
}

/* Flash overlay */
function flashOverlay(msg="TIME'S UP"){
  overlay.textContent=msg;
  overlay.style.visibility="visible";
  overlay.style.animation="flash 0.65s ease-in-out 3";
  setTimeout(()=>{ overlay.style.visibility="hidden"; overlay.textContent=""; overlay.style.animation=""; },2000);
}

/* Auto-pass / end */
function handleAutoPassOrEnd(){
  if(passCount<3){ passCount++; currentTeam=(currentTeam+1)%teams.length; updateCurrentTeamDisplay(); setTimeout(()=>{ startTimerPass(); },500); }
  else{ disableAllOptions(); showAnswerBtn.disabled=false; }
}

/* Questions */
function loadQuestion(){
  if(qIndex>=questions.length){ qText.textContent="Quiz Finished. Great job!"; optionsWrap.innerHTML=""; showAnswerBtn.disabled=true; nextBtn.disabled=true; return; }

  currentTeam=startTeamIndex%teams.length; startTeamIndex++; passCount=0;
  questionCompleted=false; clickedSet.clear(); overlay.style.visibility="hidden";

  const q=questions[qIndex];
  qText.textContent=q.question;

  optionsWrap.innerHTML="";
  q.options.forEach((opt,i)=>{
    const btn=document.createElement("button"); btn.className="option"; btn.dataset.index=i;
    if(isImageUrl(opt)){
      const url=opt.trim().toLowerCase().startsWith("img:")?opt.trim().slice(4).trim():opt.trim();
      const img=document.createElement("img"); img.src=url; img.alt=`Option ${i+1}`; btn.appendChild(img);
    }else btn.textContent=opt;

    btn.addEventListener("click",()=> handleOptionClick(btn,i));
    optionsWrap.appendChild(btn);
  });

  correctIndex=q.answerIndex;
  nextBtn.disabled=true; showAnswerBtn.disabled=true;
  updateCurrentTeamDisplay();
  startTimerMain();
}

function handleOptionClick(btn,i){
  if(questionCompleted) return;
  clickedSet.add(i); const isCorrect=(i===correctIndex);
  if(isCorrect){
    btn.classList.add("correct"); disableAllOptions(); clearInterval(timerId); overlay.style.visibility="hidden";
    teams[currentTeam].score+=PASS_POINTS[Math.min(passCount,PASS_POINTS.length-1)]; renderTeams();
    showAnswerBtn.disabled=false;
  }else{
    btn.classList.add("wrong"); btn.disabled=true;
    const allDisabled=Array.from(document.querySelectorAll(".option")).every(b=>b.disabled);
    if(allDisabled){ clearInterval(timerId); showAnswerBtn.disabled=false; return; }
    clearInterval(timerId); handleAutoPassOrEnd();
  }
}
function disableAllOptions(){ document.querySelectorAll(".option").forEach(b=>b.disabled=true); }

showAnswerBtn.addEventListener("click",()=>{
  document.querySelectorAll(".option").forEach((b,idx)=>{ if(idx===correctIndex) b.classList.add("correct"); b.disabled=true; });
  questionCompleted=true; nextBtn.disabled=false; showAnswerBtn.disabled=true;
});
nextBtn.addEventListener("click",()=>{ qIndex++; loadQuestion(); });

/* CSV */
async function loadCSV(){
  const res=await fetch(CSV_URL); const text=await res.text(); const rows=csvToRows(text);
  const header=rows[0].map(h=>h.trim().toLowerCase()); const qi=header.indexOf("question");
  const a1=header.indexOf("option1"), a2=header.indexOf("option2"), a3=header.indexOf("option3"), a4=header.indexOf("option4");
  const ans=header.indexOf("answer");

  questions=rows.slice(1).filter(r=>r.length && r[qi]).map(r=>{
    const opts=[r[a1],r[a2],r[a3],r[a4]].map(x=>(x||"").trim());
    const answerText=(r[ans]||"").trim();
    let answerIndex=-1; const n=parseInt(answerText,10);
    if(!Number.isNaN(n)&&n>=1&&n<=4) answerIndex=n-1;
    else answerIndex=opts.findIndex(o=>o===answerText);
    if(answerIndex<0) answerIndex=0;
    return { question:r[qi], options:opts, answerIndex };
  });
}

/* Init */
loadCSV().then(()=>{ renderTeams(); loadQuestion(); });
</script>
</body>
</html>
